<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Group5F25.APP.Pages.TripHistoryPage">

    <Grid Padding="16"
          RowSpacing="12"
          RowDefinitions="Auto,*">

        <!-- Row 0: header + filters + error -->
        <VerticalStackLayout Grid.Row="0"
                             Spacing="8">

            <!-- Title -->
            <Label Text="Trip History"
                   FontSize="24"
                   FontAttributes="Bold"
                   HorizontalOptions="Start" />

            <!-- Segmented control + Refresh -->
            <Grid ColumnDefinitions="*,Auto"
                  ColumnSpacing="8">

                <HorizontalStackLayout Grid.Column="0"
                                       Spacing="4">

                    <!-- All -->
                    <Button Text="All"
                            Padding="10,4"
                            Command="{Binding ChangeFilterCommand}"
                            CommandParameter="All">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="BackgroundColor" Value="Transparent" />
                                <Setter Property="TextColor" Value="Black" />
                                <Setter Property="BorderColor" Value="#CCCCCC" />
                                <Setter Property="BorderWidth" Value="1" />
                                <Setter Property="CornerRadius" Value="16" />
                                <Style.Triggers>
                                    <DataTrigger TargetType="Button"
                                                 Binding="{Binding SelectedFilter}"
                                                 Value="All">
                                        <Setter Property="BackgroundColor" Value="#2563EB" />
                                        <Setter Property="TextColor" Value="White" />
                                        <Setter Property="BorderColor" Value="#2563EB" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>

                    <!-- Last 7 Days -->
                    <Button Text="Last 7 Days"
                            Padding="10,4"
                            Command="{Binding ChangeFilterCommand}"
                            CommandParameter="Last 7 Days">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="BackgroundColor" Value="Transparent" />
                                <Setter Property="TextColor" Value="Black" />
                                <Setter Property="BorderColor" Value="#CCCCCC" />
                                <Setter Property="BorderWidth" Value="1" />
                                <Setter Property="CornerRadius" Value="16" />
                                <Style.Triggers>
                                    <DataTrigger TargetType="Button"
                                                 Binding="{Binding SelectedFilter}"
                                                 Value="Last 7 Days">
                                        <Setter Property="BackgroundColor" Value="#2563EB" />
                                        <Setter Property="TextColor" Value="White" />
                                        <Setter Property="BorderColor" Value="#2563EB" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>

                    <!-- Last 30 Days -->
                    <Button Text="Last 30 Days"
                            Padding="10,4"
                            Command="{Binding ChangeFilterCommand}"
                            CommandParameter="Last 30 Days">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="BackgroundColor" Value="Transparent" />
                                <Setter Property="TextColor" Value="Black" />
                                <Setter Property="BorderColor" Value="#CCCCCC" />
                                <Setter Property="BorderWidth" Value="1" />
                                <Setter Property="CornerRadius" Value="16" />
                                <Style.Triggers>
                                    <DataTrigger TargetType="Button"
                                                 Binding="{Binding SelectedFilter}"
                                                 Value="Last 30 Days">
                                        <Setter Property="BackgroundColor" Value="#2563EB" />
                                        <Setter Property="TextColor" Value="White" />
                                        <Setter Property="BorderColor" Value="#2563EB" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>

                </HorizontalStackLayout>

                <!-- Refresh button -->
                <Button Grid.Column="1"
                        Text="Refresh"
                        Command="{Binding RefreshCommand}" />
            </Grid>

            <!-- Error message -->
            <Label Text="{Binding ErrorMessage}"
                   TextColor="Red"
                   FontSize="12" />
        </VerticalStackLayout>

        <!-- Row 1: scrollable list -->
        <CollectionView Grid.Row="1"
                        ItemsSource="{Binding FilteredTrips}"
                        Margin="0,0,0,0"
                        VerticalOptions="FillAndExpand">
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame Padding="12"
                           Margin="0,4"
                           HasShadow="False"
                           BorderColor="#DDDDDD"
                           CornerRadius="8">
                        <VerticalStackLayout Spacing="2">
                            <Label Text="{Binding StartTime, StringFormat='Start: {0:yyyy-MM-dd h:mm tt}'}"
                                   FontAttributes="Bold" />
                            <Label Text="{Binding EndTime, StringFormat='End:   {0:yyyy-MM-dd h:mm tt}'}" />
                        </VerticalStackLayout>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

    </Grid>
</ContentPage>
